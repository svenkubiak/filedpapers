const $id=e=>document.getElementById(e),$=e=>document.querySelector(e),$$=e=>document.querySelectorAll(e),on=(e,t,o)=>{const a="string"==typeof e?document.querySelector(e):e;a&&a.addEventListener(t,o)},onAll=(e,t,o)=>{const a=$$(e);a.length&&a.forEach((e=>e.addEventListener(t,o)))},forAll=(e,t)=>{const o=$$(e);o.length&&o.forEach(t)};let $categoryToRename=null;const toastSuccess="toast-success",toastError="toast-error",poll=$id("poll-js").dataset,i18n=$id("i18n-js").dataset,generalError=i18n.error,archivedSuccess=i18n.archivedSuccess,bookmarkMovedSuccess=i18n.bookmarkMovedSuccess,categoryDeletedSuccess=i18n.categoryDeletedSuccess,categoryRenamedSuccess=i18n.categoryRenamedSuccess,trashEmptiedSuccess=i18n.trashEmptiedSuccess,bookmarkDeletedSuccess=i18n.bookmarkDeletedSuccess,categoryCreatedSuccess=i18n.categoryCreatedSuccess,bookmarkCreatedSuccess=i18n.bookmarkCreatedSuccess,logoutDevicesSuccess=i18n.logoutDevicesSuccess,csrfToken=$id("x-csrf-token")?.dataset?.csrfToken??"";function openModal(e){e.classList.add("is-active"),"add-category-modal"===e.id&&setTimeout((()=>{$id("category").focus()}),100)}function closeModal(e){e.classList.remove("is-active")}function closeAllModals(){forAll(".modal",closeModal)}function showLoading(e){const t=$id(e);t&&(t.classList.add("is-loading"),t.disabled=!0)}function handleAddClick(){openModal($id("add-category-modal"))}function handleDragStart(e){const t=e.currentTarget,o=document.createElement("div");o.className="drag-icon",o.innerHTML='<i class="fas fa-bookmark fa-2x"></i>',o.style.position="absolute",o.style.top="-1000px",o.style.color="#3273dc",document.body.appendChild(o),e.dataTransfer.setDragImage(o,25,25),t.closest(".card")?.classList.add("dragging"),e.dataTransfer.setData("text/plain",t.dataset.uid),setTimeout((()=>{document.body.removeChild(o)}),0)}function handleDragEnd(e){const t=e.currentTarget;t.closest(".card")?.classList.remove("dragging")}function handleDragOver(e){e.preventDefault(),e.currentTarget.classList.add("drag-over")}function handleDragLeave(e){e.currentTarget.classList.remove("drag-over")}function handleDrop(e){e.preventDefault();const t=e.currentTarget;t.classList.remove("drag-over");const o=e.dataTransfer.getData("text/plain"),a=t.dataset.uid;axios.put("/api/v1/items",{uid:o,category:a}).then((function(e){sessionStorage.setItem(toastSuccess,bookmarkMovedSuccess)})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){window.location.href="/dashboard"}))}function handleCardTrashClick(e){e.preventDefault(),e.stopPropagation(),deleteItem(e.currentTarget.closest(".card"))}function handleDeleteAccountClick(e){e.preventDefault(),e.stopPropagation(),openModal($id("delete-account-modal"))}function handleLogoutDevicesClick(e){e.preventDefault(),e.stopPropagation(),openModal($id("logout-devices-confirm-modal"))}function handleCategoryTrashClick(e){e.preventDefault(),e.stopPropagation(),$categoryToDelete=e.currentTarget,openModal($id("delete-category-confirm-modal"))}function handleCategoryRenameClick(e){e.preventDefault(),e.stopPropagation(),$categoryToRename=e.currentTarget,$id("existing-category").value=$categoryToRename.dataset.name,openModal($id("rename-category-modal"))}function handleConfirmCategoryDelete(){if($categoryToDelete){const e=$categoryToDelete.dataset.uid;axios.delete("/api/v1/categories/"+e).then((function(e){closeAllModals(),sessionStorage.setItem(toastSuccess,categoryDeletedSuccess)})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){closeAllModals(),window.location.href="/dashboard"}))}}function handleCardArchiveClick(e){const t=e.currentTarget.dataset.uid;axios.post("/api/v1/archive/"+t).then((function(e){showToast(archivedSuccess)})).catch((function(e){console.log(e),showToast(generalError)}))}function handleLogoutDevices(){axios.post("/dashboard/profile/logout-devices").then((function(e){closeAllModals(),sessionStorage.setItem(toastSuccess,logoutDevicesSuccess)})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){window.location.href="/dashboard/profile"}))}function handleAddCategory(e){e.preventDefault();const t=$id("category"),o=t?.value;o?axios.post("/api/v1/categories",{name:o}).then((function(e){sessionStorage.setItem(toastSuccess,categoryCreatedSuccess),t.value="",closeAllModals()})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){window.location.href="/dashboard"})):t?.classList.add("is-danger")}function handleRenameCategory(e){e.preventDefault();const t=$id("existing-category"),o=$categoryToRename.dataset.uid,a=t?.value;a?axios.put("/api/v1/categories",{uid:o,name:a}).then((function(e){sessionStorage.setItem(toastSuccess,categoryRenamedSuccess),t.value="",closeAllModals()})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){window.location.href="/dashboard/"+o})):t?.classList.add("is-danger")}function confirmEmptyTrash(){axios.delete("/api/v1/items/trash").then((function(e){closeAllModals(),sessionStorage.setItem(toastSuccess,trashEmptiedSuccess)})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){window.location.href="/dashboard"}))}function deleteItem(e){e.style.transition="all 0.3s ease",e.style.opacity="0",setTimeout((()=>{e.closest(".column").remove()}),300);const t=e.dataset.uid,o=e.dataset.category;axios.put("/api/v1/items/"+t).then((()=>{closeAllModals(),sessionStorage.setItem(toastSuccess,bookmarkDeletedSuccess)})).catch((e=>{console.log(e),sessionStorage.setItem(toastError,e)})).finally((()=>{window.location.href="/dashboard/"+o}))}function emptyTrash(e){e.preventDefault(),e.stopPropagation(),openModal($id("empty-trash-confirm-modal"))}function clearUrlError(){$id("bookmark-url")?.classList.remove("is-danger")}function showToast(e,t="success",o=3e3){const a=document.querySelector(".toast-container");if(!a)return;const n=document.createElement("div");n.className="toast "+("error"===t?"is-danger":""),n.innerHTML=`\n        <span class="icon">\n            <i class="fas ${"error"===t?"fa-exclamation-circle":"fa-check-circle"}"></i>\n        </span>\n        <span>${e}</span>\n    `,a.appendChild(n),n.offsetHeight,requestAnimationFrame((()=>{n.classList.add("is-active")})),setTimeout((()=>{n.classList.remove("is-active"),setTimeout((()=>{a.removeChild(n)}),300)}),o)}function addBookmarkModal(){openModal($id("add-bookmark-modal"))}function handleToastsOnLoad(){const e=sessionStorage.getItem(toastSuccess);e&&(showToast(e),sessionStorage.removeItem(toastSuccess));const t=sessionStorage.getItem(toastError);t&&(showToast(t,"error"),sessionStorage.setItem(toastError,""))}function addBookmark(e){e.preventDefault(),e.stopPropagation();const t=$id("bookmark-url").value,o=$id("bookmark-category").value,a=$id("confirm-add-bookmark");t&&o&&(a.classList.add("is-loading"),a.disabled=!0,axios.post("/api/v1/items",{url:t,category:o}).then((function(e){sessionStorage.setItem(toastSuccess,bookmarkCreatedSuccess),closeAllModals(),window.location.href="/dashboard/"+o})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){a.classList.remove("is-loading"),a.disabled=!1})))}function search(e){const t=e?.target?.value.toLowerCase()||"";$$(".card").forEach((e=>{const o=e.querySelector(".card-title")?.textContent.toLowerCase()||"",a=e.closest(".column");a&&(a.style.display=t?o.includes(t)?"":"none":"")}))}function handleKeyNavigation(e){if("Enter"===e.key){const o=(t=".modal.is-active",document.querySelector(t));if(!o)return;const a=o.querySelector("[data-confirm]");a&&(e.preventDefault(),a.click())}var t;"Escape"===e.code&&closeAllModals()}function openPopup(e){const t=e.currentTarget.dataset.uid;window.open("/media/archive/"+t,"Archived","width=1280,height=720,left=100,top=100,resizable=no,scrollbars=yes,menubar=no,toolbar=no,location=no,noopener,noreferrer")}function setupAutoFocusNext(e){forAll(e,((e,t,o)=>{on(e,"input",(e=>{const a=e.target.value;e.target.value=a.replace(/[^0-9]/g,"").slice(0,1),e.target.value&&t<o.length-1&&o[t+1].focus()}))}))}function focusFirstVisibleInput(e){const t=document.querySelectorAll(e);for(let e of t)if(null!==e.offsetParent){e.focus();break}}async function polling(){try{const e=$$(".card").length,t=window.location.pathname.match(/\/dashboard\/(.+)/),o=t?t[1]:null;axios.post("/api/v1/categories/poll",{count:e.toString(),category:o},{validateStatus:function(e){return 200===e||304===e}}).then((function(e){200===e.status&&location.reload()})).catch((function(e){console.log(e)})),setTimeout(polling,3e3)}catch(e){console.log(e)}}axios.defaults.headers.common["x-csrf-token"]=csrfToken,focusFirstVisibleInput(".otp-input"),setupAutoFocusNext(".otp-input"),on(document,"keydown",handleKeyNavigation),on(window,"load",handleToastsOnLoad),on("#add-category-button","click",handleAddClick),on("#add-category-submit","click",handleAddCategory),on("#rename-category-submit","click",handleRenameCategory),on("#confirm-empty-trash","click",confirmEmptyTrash),on("#bookmark-url","input",clearUrlError),on("#add-bookmark","click",addBookmarkModal),on("#search-input","input",search),on("#confirm-add-bookmark","click",addBookmark),on("#confirm-logout-devices","click",handleLogoutDevices),on("#logout-devices","click",handleLogoutDevicesClick),on("#delete-account","click",handleDeleteAccountClick),on("#confirm-category-delete","click",handleConfirmCategoryDelete),onAll(".open-archive","click",openPopup),onAll(".category-trash","click",handleCategoryTrashClick),onAll(".category-rename","click",handleCategoryRenameClick),onAll(".card-trash","click",handleCardTrashClick),onAll(".card-archive","click",handleCardArchiveClick),onAll(".modal-background, .modal-card-head .delete, .modal-card-foot .button:not(.is-danger)","click",closeAllModals),onAll(".empty-trash","click",emptyTrash),forAll('.dragging[draggable="true"]',(e=>{e.addEventListener("dragstart",handleDragStart),e.addEventListener("dragend",handleDragEnd)})),forAll(".menu-list a[data-category]",(e=>{e.addEventListener("dragover",handleDragOver),e.addEventListener("dragleave",handleDragLeave),e.addEventListener("drop",handleDrop)})),null!=poll&&"true"===poll.poll&&polling();class ThemeManager{constructor(){this.theme=this.getStoredTheme(),this.init()}init(){this.applyTheme(this.theme),this.createToggleButton()}getStoredTheme(){const e=localStorage.getItem("theme");return!e||"light"!==e&&"dark"!==e?window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e}applyTheme(e){const t=document.documentElement;"dark"===e?(t.setAttribute("data-theme","dark"),t.classList.add("theme-dark")):(t.removeAttribute("data-theme"),t.classList.remove("theme-dark")),this.theme=e,localStorage.setItem("theme",e)}toggleTheme(){const e="light"===this.theme?"dark":"light";this.applyTheme(e),this.updateToggleButton()}createToggleButton(){const e=document.getElementById("theme-toggle");e&&e.remove();const t=document.createElement("button");t.id="theme-toggle",t.className="theme-toggle-button",t.innerHTML=this.getToggleIcon(),t.setAttribute("aria-label",`Switch to ${"light"===this.theme?"dark":"light"} mode`),t.setAttribute("title",`Switch to ${"light"===this.theme?"dark":"light"} mode`),t.addEventListener("click",(()=>this.toggleTheme())),document.body.appendChild(t)}updateToggleButton(){const e=document.getElementById("theme-toggle");e&&(e.innerHTML=this.getToggleIcon(),e.setAttribute("aria-label",`Switch to ${"light"===this.theme?"dark":"light"} mode`),e.setAttribute("title",`Switch to ${"light"===this.theme?"dark":"light"} mode`))}getToggleIcon(){return"light"===this.theme?"🌙":"☀️"}}let themeToggle;function toggleTheme(){themeToggle&&themeToggle.toggleTheme()}document.addEventListener("DOMContentLoaded",(()=>{themeToggle=new ThemeManager}));