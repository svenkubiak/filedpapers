let $cardToDelete=null;const toastSuccess="toast-success",toastError="toast-error",error=document.getElementById("i18n-js").dataset.error,bookmarkMovedSuccess=document.getElementById("i18n-js").dataset.bookmarkMovedSuccess,categoryDeletedSuccess=document.getElementById("i18n-js").dataset.categoryDeletedSuccess,trashEmptiedSuccess=document.getElementById("i18n-js").dataset.trashEmptiedSuccess,bookmarkDeletedSuccess=document.getElementById("i18n-js").dataset.bookmarkDeletedSuccess,categoryCreatedSuccess=document.getElementById("i18n-js").dataset.categoryCreatedSuccess,bookmarkCreatedSuccess=document.getElementById("i18n-js").dataset.bookmarkCreatedSuccess,logoutDevicesSuccess=document.getElementById("i18n-js").dataset.logoutDevicesSuccess,$addButton=document.getElementById("add-category-button"),$addBookmark=document.getElementById("add-bookmark-modal"),$modal=document.getElementById("add-category-modal"),$deleteModal=document.getElementById("delete-confirm-modal"),$deleteAccountModal=document.getElementById("delete-account-modal"),$logoutDevicesModal=document.getElementById("logout-devices-confirm-modal"),$deleteCategoryModal=document.getElementById("delete-category-confirm-modal"),$emptyTrashModal=document.getElementById("empty-trash-confirm-modal"),$closeButtons=document.querySelectorAll(".modal-background, .modal-card-head .delete, .modal-card-foot .button:not(.is-danger)"),draggableItems=document.querySelectorAll('.dragging[draggable="true"]'),categoryTargets=document.querySelectorAll(".menu-list a[data-category]"),$addBookmarkSubmit=document.getElementById("add-category-submit"),$confirmAddBookmark=document.getElementById("confirm-add-bookmark"),deleteAccount=document.getElementById("delete-account"),logoutDevices=document.getElementById("logout-devices"),$bookmarkUrl=document.getElementById("bookmark-url"),fabButton=document.getElementById("fab-add-bookmark"),applicationJson="application/json";function openModal(e){e.classList.add("is-active"),"add-category-modal"===e.id&&setTimeout(()=>{document.getElementById("category").focus()},100)}function closeModal(e){e.classList.remove("is-active")}function closeAllModals(){document.querySelectorAll(".modal").forEach(e=>{closeModal(e)})}function showLoading(e){console.log("element: "+e);let t=document.getElementById(e);t&&(t.classList.add("is-loading"),t.disabled=!0)}function showToast(e,t="success",a=3e3){let o=document.querySelector(".toast-container"),s=document.createElement("div");s.className=`toast ${"error"===t?"is-danger":""}`,s.innerHTML=`
        <span class="icon">
            <i class="fas ${"error"===t?"fa-exclamation-circle":"fa-check-circle"}"></i>
        </span>
        <span>${e}</span>
    `,o.appendChild(s),s.offsetHeight,requestAnimationFrame(()=>{s.classList.add("is-active")}),setTimeout(()=>{s.classList.remove("is-active"),setTimeout(()=>{o.removeChild(s)},300)},a)}async function poll(){try{let e=document.querySelectorAll(".card"),t=window.location.pathname,a=t.match(/\/dashboard\/(.+)/),o=a?a[1]:null,s=await fetch("/api/v1/categories/poll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({count:e.length.toString(),category:o})});s.ok&&location.reload(),setTimeout(poll,3e3)}catch(r){}}$addButton.addEventListener("click",()=>{openModal($modal)}),$closeButtons.forEach(e=>{e.addEventListener("click",()=>{closeAllModals()})}),document.addEventListener("keydown",e=>{"Escape"===e.code&&closeAllModals()}),draggableItems.forEach(e=>{e.addEventListener("dragstart",t=>{let a=document.createElement("div");a.className="drag-icon",a.innerHTML='<i class="fas fa-bookmark fa-2x"></i>',a.style.position="absolute",a.style.top="-1000px",a.style.color="#3273dc",document.body.appendChild(a),t.dataTransfer.setDragImage(a,25,25),e.closest(".card").classList.add("dragging"),t.dataTransfer.setData("text/plain",e.dataset.uid),setTimeout(()=>{document.body.removeChild(a)},0)}),e.addEventListener("dragend",()=>{e.closest(".card").classList.remove("dragging")})}),categoryTargets.forEach(e=>{e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("drag-over")}),e.addEventListener("dragleave",()=>{e.classList.remove("drag-over")}),e.addEventListener("drop",async t=>{t.preventDefault(),e.classList.remove("drag-over");let a=t.dataTransfer.getData("text/plain"),o=e.dataset.uid,s=await fetch("/api/v1/items",{method:"PUT",body:JSON.stringify({uid:a,category:o}),headers:{"Content-type":applicationJson}});s.ok?sessionStorage.setItem(toastSuccess,bookmarkMovedSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard"})}),document.querySelectorAll(".card-trash").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),$cardToDelete=e.currentTarget.closest(".card"),openModal($deleteModal)})}),deleteAccount&&deleteAccount.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),openModal($deleteAccountModal)}),logoutDevices&&logoutDevices.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),openModal($logoutDevicesModal)}),document.querySelectorAll(".category-trash").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),$categoryToDelete=e.currentTarget,openModal($deleteCategoryModal)})}),document.querySelectorAll(".empty-trash").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),openModal($emptyTrashModal)})}),document.getElementById("confirm-category-delete").addEventListener("click",async()=>{if($categoryToDelete){let e=$categoryToDelete.dataset.uid,t=await fetch("/api/v1/categories/"+e,{method:"DELETE",headers:{"Content-type":applicationJson}});t.ok?sessionStorage.setItem(toastSuccess,categoryDeletedSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard"}closeModal($deleteCategoryModal)}),document.getElementById("confirm-logout-devices").addEventListener("click",async()=>{let e=await fetch("/dashboard/profile/logout-devices",{method:"POST"});e.ok?sessionStorage.setItem(toastSuccess,logoutDevicesSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard/profile"}),document.getElementById("confirm-empty-trash").addEventListener("click",async()=>{let e=await fetch("/api/v1/items/trash",{method:"DELETE",headers:{"Content-type":applicationJson}});e.ok?sessionStorage.setItem(toastSuccess,trashEmptiedSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard"}),document.getElementById("confirm-delete").addEventListener("click",async()=>{if($cardToDelete){$cardToDelete.style.transition="all 0.3s ease",$cardToDelete.style.opacity="0",setTimeout(()=>{$cardToDelete.closest(".column").remove()},300);let e=$cardToDelete.dataset.uid,t=$cardToDelete.dataset.category,a=await fetch("/api/v1/items/"+e,{method:"PUT",headers:{"Content-type":applicationJson}});a.ok?sessionStorage.setItem(toastSuccess,bookmarkDeletedSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard/"+t}}),$addBookmarkSubmit&&$addBookmarkSubmit.addEventListener("click",async e=>{e.preventDefault();let t=document.getElementById("category").value;if(t){let a=await fetch("/api/v1/categories",{method:"POST",body:JSON.stringify({name:t}),headers:{"Content-type":applicationJson}});a.ok?sessionStorage.setItem(toastSuccess,categoryCreatedSuccess):sessionStorage.setItem(toastError,error),document.getElementById("category").value="",closeAllModals(),window.location.href="/dashboard"}else document.getElementById("category").classList.add("is-danger")}),$bookmarkUrl&&$bookmarkUrl.addEventListener("input",()=>{$bookmarkUrl.classList.remove("is-danger")}),window.addEventListener("load",()=>{let e=sessionStorage.getItem(toastSuccess);e&&(showToast(e),sessionStorage.setItem(toastSuccess,""));let t=sessionStorage.getItem(toastError);t&&(showToast(t,"error"),sessionStorage.setItem(toastError,""))}),fabButton&&fabButton.addEventListener("click",()=>{openModal($addBookmark)}),$confirmAddBookmark&&$confirmAddBookmark.addEventListener("click",async e=>{e.preventDefault();let t=document.getElementById("bookmark-url").value,a=document.getElementById("bookmark-category").value;if(t&&a){$confirmAddBookmark.classList.add("is-loading"),$confirmAddBookmark.disabled=!0;let o=await fetch("/api/v1/items",{method:"POST",headers:{"Content-type":applicationJson},body:JSON.stringify({url:t,category:a.toLowerCase()})});o.ok?sessionStorage.setItem(toastSuccess,bookmarkCreatedSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard/"+a,$addBookmarkSubmit.classList.remove("is-loading"),$addBookmarkSubmit.disabled=!1}}),document.querySelectorAll(".image-container").forEach(e=>{let t=e.querySelector(".image-with-fallback"),a=e.querySelector(".spinner"),o=!1,s=()=>{a.style.display="none",t.style.display="block"},r=()=>{o||(o=!0,s())},l=()=>{o||(o=!0,a.style.display="none",t.style.display="block",t.src="/assets/images/placeholder.svg")};t.onload=r,t.onerror=l,t.complete?t.naturalWidth>0?r():l():setTimeout(()=>{o||l()},4e3)}),document.getElementById("searchInput").addEventListener("input",function(e){let t=e.target.value.toLowerCase(),a=document.querySelectorAll(".card");a.forEach(e=>{let a=e.querySelector(".card-title").textContent.toLowerCase();a.includes(t)?e.closest(".column").style.display="":e.closest(".column").style.display="none"})}),poll();