const $id=e=>document.getElementById(e),$=e=>document.querySelector(e),$$=e=>document.querySelectorAll(e),on=(e,o,t)=>{const a="string"==typeof e?document.querySelector(e):e;a&&a.addEventListener(o,t)},onAll=(e,o,t)=>{const a=$$(e);a.length&&a.forEach((e=>e.addEventListener(o,t)))},forAll=(e,o)=>{const t=$$(e);t.length&&t.forEach(o)};let $categoryToRename=null;const toastSuccess="toast-success",toastError="toast-error",poll=$id("poll-js").dataset,i18n=$id("i18n-js").dataset,generalError=i18n.error,archivedSuccess=i18n.archivedSuccess,bookmarkMovedSuccess=i18n.bookmarkMovedSuccess,categoryDeletedSuccess=i18n.categoryDeletedSuccess,categoryRenamedSuccess=i18n.categoryRenamedSuccess,trashEmptiedSuccess=i18n.trashEmptiedSuccess,bookmarkDeletedSuccess=i18n.bookmarkDeletedSuccess,categoryCreatedSuccess=i18n.categoryCreatedSuccess,bookmarkCreatedSuccess=i18n.bookmarkCreatedSuccess,logoutDevicesSuccess=i18n.logoutDevicesSuccess,csrfToken=$id("x-csrf-token")?.dataset?.csrfToken??"";function openModal(e){e.classList.add("is-active"),"add-category-modal"===e.id&&setTimeout((()=>{$id("category").focus()}),100)}function closeModal(e){e.classList.remove("is-active")}function closeAllModals(){forAll(".modal",closeModal)}function showLoading(e){const o=$id(e);o&&(o.classList.add("is-loading"),o.disabled=!0)}function handleAddClick(){openModal($id("add-category-modal"))}function handleDragStart(e){const o=e.currentTarget,t=document.createElement("div");t.className="drag-icon",t.innerHTML='<i class="fas fa-bookmark fa-2x"></i>',t.style.position="absolute",t.style.top="-1000px",t.style.color="#3273dc",document.body.appendChild(t),e.dataTransfer.setDragImage(t,25,25),o.closest(".card")?.classList.add("dragging"),e.dataTransfer.setData("text/plain",o.dataset.uid),setTimeout((()=>{document.body.removeChild(t)}),0)}function handleDragEnd(e){const o=e.currentTarget;o.closest(".card")?.classList.remove("dragging")}function handleDragOver(e){e.preventDefault(),e.currentTarget.classList.add("drag-over")}function handleDragLeave(e){e.currentTarget.classList.remove("drag-over")}function handleDrop(e){e.preventDefault();const o=e.currentTarget;o.classList.remove("drag-over");const t=e.dataTransfer.getData("text/plain"),a=o.dataset.uid;axios.put("/api/v1/items",{uid:t,category:a}).then((function(e){sessionStorage.setItem(toastSuccess,bookmarkMovedSuccess)})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){window.location.href="/dashboard"}))}function handleCardTrashClick(e){e.preventDefault(),e.stopPropagation(),deleteItem(e.currentTarget.closest(".card"))}function handleDeleteAccountClick(e){e.preventDefault(),e.stopPropagation(),openModal($id("delete-account-modal"))}function handleLogoutDevicesClick(e){e.preventDefault(),e.stopPropagation(),openModal($id("logout-devices-confirm-modal"))}function handleCategoryTrashClick(e){e.preventDefault(),e.stopPropagation(),$categoryToDelete=e.currentTarget,openModal($id("delete-category-confirm-modal"))}function handleCategoryRenameClick(e){e.preventDefault(),e.stopPropagation(),$categoryToRename=e.currentTarget,$id("existing-category").value=$categoryToRename.dataset.name,openModal($id("rename-category-modal"))}function handleConfirmCategoryDelete(){if($categoryToDelete){const e=$categoryToDelete.dataset.uid;axios.delete("/api/v1/categories/"+e).then((function(e){closeAllModals(),sessionStorage.setItem(toastSuccess,categoryDeletedSuccess)})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){closeAllModals(),window.location.href="/dashboard"}))}}function handleCardArchiveClick(e){const o=e.currentTarget.dataset.uid;axios.post("/api/v1/archive/"+o).then((function(e){showToast(archivedSuccess)})).catch((function(e){console.log(e),showToast(generalError)}))}function handleLogoutDevices(){axios.post("/dashboard/profile/logout-devices").then((function(e){closeAllModals(),sessionStorage.setItem(toastSuccess,logoutDevicesSuccess)})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){window.location.href="/dashboard/profile"}))}function handleAddCategory(e){e.preventDefault();const o=$id("category"),t=o?.value;t?axios.post("/api/v1/categories",{name:t}).then((function(e){sessionStorage.setItem(toastSuccess,categoryCreatedSuccess),o.value="",closeAllModals()})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){window.location.href="/dashboard"})):o?.classList.add("is-danger")}function handleRenameCategory(e){e.preventDefault();const o=$id("existing-category"),t=$categoryToRename.dataset.uid,a=o?.value;a?axios.put("/api/v1/categories",{uid:t,name:a}).then((function(e){sessionStorage.setItem(toastSuccess,categoryRenamedSuccess),o.value="",closeAllModals()})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){window.location.href="/dashboard/"+t})):o?.classList.add("is-danger")}function confirmEmptyTrash(){axios.delete("/api/v1/items/trash").then((function(e){closeAllModals(),sessionStorage.setItem(toastSuccess,trashEmptiedSuccess)})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){window.location.href="/dashboard"}))}function deleteItem(e){e.style.transition="all 0.3s ease",e.style.opacity="0",setTimeout((()=>{e.closest(".column").remove()}),300);const o=e.dataset.uid,t=e.dataset.category;axios.put("/api/v1/items/"+o).then((()=>{closeAllModals(),sessionStorage.setItem(toastSuccess,bookmarkDeletedSuccess)})).catch((e=>{console.log(e),sessionStorage.setItem(toastError,e)})).finally((()=>{window.location.href="/dashboard/"+t}))}function emptyTrash(e){e.preventDefault(),e.stopPropagation(),openModal($id("empty-trash-confirm-modal"))}function clearUrlError(){$id("bookmark-url")?.classList.remove("is-danger")}function showToast(e,o="success",t=3e3){const a=document.querySelector(".toast-container");if(!a)return;const n=document.createElement("div");n.className="toast "+("error"===o?"is-danger":""),n.innerHTML=`\n        <span class="icon">\n            <i class="fas ${"error"===o?"fa-exclamation-circle":"fa-check-circle"}"></i>\n        </span>\n        <span>${e}</span>\n    `,a.appendChild(n),n.offsetHeight,requestAnimationFrame((()=>{n.classList.add("is-active")})),setTimeout((()=>{n.classList.remove("is-active"),setTimeout((()=>{a.removeChild(n)}),300)}),t)}function addBookmarkModal(){openModal($id("add-bookmark-modal"))}function handleToastsOnLoad(){const e=sessionStorage.getItem(toastSuccess);e&&(showToast(e),sessionStorage.removeItem(toastSuccess));const o=sessionStorage.getItem(toastError);o&&(showToast(o,"error"),sessionStorage.setItem(toastError,""))}function addBookmark(e){e.preventDefault(),e.stopPropagation();const o=$id("bookmark-url").value,t=$id("bookmark-category").value,a=$id("confirm-add-bookmark");o&&t&&(a.classList.add("is-loading"),a.disabled=!0,axios.post("/api/v1/items",{url:o,category:t}).then((function(e){sessionStorage.setItem(toastSuccess,bookmarkCreatedSuccess),closeAllModals(),window.location.href="/dashboard/"+t})).catch((function(e){console.log(e),sessionStorage.setItem(toastError,generalError)})).finally((function(){a.classList.remove("is-loading"),a.disabled=!1})))}function search(e){if(!e?.target?.value)return;const o=e.target.value.toLowerCase();$$(".card").forEach((e=>{const t=e.querySelector(".card-title")?.textContent.toLowerCase()||"",a=e.closest(".column");a&&(a.style.display=t.includes(o)?"":"none")}))}function handleKeyNavigation(e){if("Enter"===e.key){const t=(o=".modal.is-active",document.querySelector(o));if(!t)return;const a=t.querySelector("[data-confirm]");a&&(e.preventDefault(),a.click())}var o;"Escape"===e.code&&closeAllModals()}function openPopup(e){const o=e.currentTarget.dataset.uid;window.open("/media/archive/"+o,"Archived","width=1280,height=720,left=100,top=100,resizable=no,scrollbars=yes,menubar=no,toolbar=no,location=no,noopener,noreferrer")}function setupAutoFocusNext(e){forAll(e,((e,o,t)=>{on(e,"input",(e=>{const a=e.target.value;e.target.value=a.replace(/[^0-9]/g,"").slice(0,1),e.target.value&&o<t.length-1&&t[o+1].focus()}))}))}function focusFirstVisibleInput(e){const o=document.querySelectorAll(e);for(let e of o)if(null!==e.offsetParent){e.focus();break}}async function polling(){try{const e=$$(".card").length,o=window.location.pathname.match(/\/dashboard\/(.+)/),t=o?o[1]:null;axios.post("/api/v1/categories/poll",{count:e.toString(),category:t},{validateStatus:function(e){return 200===e||304===e}}).then((function(e){200===e.status&&location.reload()})).catch((function(e){console.log(e)})),setTimeout(polling,3e3)}catch(e){console.log(e)}}axios.defaults.headers.common["x-csrf-token"]=csrfToken,focusFirstVisibleInput(".otp-input"),setupAutoFocusNext(".otp-input"),on(document,"keydown",handleKeyNavigation),on(window,"load",handleToastsOnLoad),on("#add-category-button","click",handleAddClick),on("#add-category-submit","click",handleAddCategory),on("#rename-category-submit","click",handleRenameCategory),on("#confirm-empty-trash","click",confirmEmptyTrash),on("#bookmark-url","input",clearUrlError),on("#add-bookmark","click",addBookmarkModal),on("#search-input","input",search),on("#confirm-add-bookmark","click",addBookmark),on("#confirm-logout-devices","click",handleLogoutDevices),on("#logout-devices","click",handleLogoutDevicesClick),on("#delete-account","click",handleDeleteAccountClick),on("#confirm-category-delete","click",handleConfirmCategoryDelete),onAll(".open-archive","click",openPopup),onAll(".category-trash","click",handleCategoryTrashClick),onAll(".category-rename","click",handleCategoryRenameClick),onAll(".card-trash","click",handleCardTrashClick),onAll(".card-archive","click",handleCardArchiveClick),onAll(".modal-background, .modal-card-head .delete, .modal-card-foot .button:not(.is-danger)","click",closeAllModals),onAll(".empty-trash","click",emptyTrash),forAll('.dragging[draggable="true"]',(e=>{e.addEventListener("dragstart",handleDragStart),e.addEventListener("dragend",handleDragEnd)})),forAll(".menu-list a[data-category]",(e=>{e.addEventListener("dragover",handleDragOver),e.addEventListener("dragleave",handleDragLeave),e.addEventListener("drop",handleDrop)})),null!=poll&&"true"===poll.poll&&polling();