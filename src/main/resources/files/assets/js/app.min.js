let $cardToDelete=null,toastSuccess="toast-success",toastError="toast-error",error=document.getElementById("i18n-js").dataset.error,bookmarkMovedSuccess=document.getElementById("i18n-js").dataset.bookmarkMovedSuccess,categoryDeletedSuccess=document.getElementById("i18n-js").dataset.categoryDeletedSuccess,trashEmptiedSuccess=document.getElementById("i18n-js").dataset.trashEmptiedSuccess,bookmarkDeletedSuccess=document.getElementById("i18n-js").dataset.bookmarkDeletedSuccess,categoryCreatedSuccess=document.getElementById("i18n-js").dataset.categoryCreatedSuccess,bookmarkCreatedSuccess=document.getElementById("i18n-js").dataset.bookmarkCreatedSuccess,logoutDevicesSuccess=document.getElementById("i18n-js").dataset.logoutDevicesSuccess,searchInput=document.getElementById("searchInput"),$addButton=document.getElementById("add-category-button"),$addBookmark=document.getElementById("add-bookmark-modal"),$modal=document.getElementById("add-category-modal"),$deleteModal=document.getElementById("delete-confirm-modal"),$deleteAccountModal=document.getElementById("delete-account-modal"),$logoutDevicesModal=document.getElementById("logout-devices-confirm-modal"),$deleteCategoryModal=document.getElementById("delete-category-confirm-modal"),$emptyTrashModal=document.getElementById("empty-trash-confirm-modal"),$closeButtons=document.querySelectorAll(".modal-background, .modal-card-head .delete, .modal-card-foot .button:not(.is-danger)"),draggableItems=document.querySelectorAll('.dragging[draggable="true"]'),categoryTargets=document.querySelectorAll(".menu-list a[data-category]"),$addBookmarkSubmit=document.getElementById("add-category-submit"),$confirmAddBookmark=document.getElementById("confirm-add-bookmark"),deleteAccount=document.getElementById("delete-account"),logoutDevices=document.getElementById("logout-devices"),$bookmarkUrl=document.getElementById("bookmark-url"),fabButton=document.getElementById("fab-add-bookmark"),applicationJson="application/json";function openModal(e){e.classList.add("is-active"),"add-category-modal"===e.id&&setTimeout(()=>{document.getElementById("category").focus()},100)}function closeModal(e){e.classList.remove("is-active")}function closeAllModals(){document.querySelectorAll(".modal").forEach(e=>{closeModal(e)})}function showLoading(e){console.log("element: "+e);e=document.getElementById(e);e&&(e.classList.add("is-loading"),e.disabled=!0)}function showToast(e,t="success",o=3e3){let a=document.querySelector(".toast-container"),s=document.createElement("div");s.className="toast "+("error"===t?"is-danger":""),s.innerHTML=`
        <span class="icon">
            <i class="fas ${"error"===t?"fa-exclamation-circle":"fa-check-circle"}"></i>
        </span>
        <span>${e}</span>
    `,a.appendChild(s),s.offsetHeight,requestAnimationFrame(()=>{s.classList.add("is-active")}),setTimeout(()=>{s.classList.remove("is-active"),setTimeout(()=>{a.removeChild(s)},300)},o)}async function poll(){try{var e=document.querySelectorAll(".card"),t=window.location.pathname.match(/\/dashboard\/(.+)/),o=t?t[1]:null;(await fetch("/api/v1/categories/poll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({count:e.length.toString(),category:o})})).ok&&location.reload(),setTimeout(poll,3e3)}catch(e){}}$addButton.addEventListener("click",()=>{openModal($modal)}),$closeButtons.forEach(e=>{e.addEventListener("click",()=>{closeAllModals()})}),document.addEventListener("keydown",e=>{"Escape"===e.code&&closeAllModals()}),draggableItems.forEach(o=>{o.addEventListener("dragstart",e=>{let t=document.createElement("div");t.className="drag-icon",t.innerHTML='<i class="fas fa-bookmark fa-2x"></i>',t.style.position="absolute",t.style.top="-1000px",t.style.color="#3273dc",document.body.appendChild(t),e.dataTransfer.setDragImage(t,25,25),o.closest(".card").classList.add("dragging"),e.dataTransfer.setData("text/plain",o.dataset.uid),setTimeout(()=>{document.body.removeChild(t)},0)}),o.addEventListener("dragend",()=>{o.closest(".card").classList.remove("dragging")})}),categoryTargets.forEach(o=>{o.addEventListener("dragover",e=>{e.preventDefault(),o.classList.add("drag-over")}),o.addEventListener("dragleave",()=>{o.classList.remove("drag-over")}),o.addEventListener("drop",async e=>{e.preventDefault(),o.classList.remove("drag-over");var e=e.dataTransfer.getData("text/plain"),t=o.dataset.uid;(await fetch("/api/v1/items",{method:"PUT",body:JSON.stringify({uid:e,category:t}),headers:{"Content-type":applicationJson}})).ok?sessionStorage.setItem(toastSuccess,bookmarkMovedSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard"})}),document.querySelectorAll(".card-trash").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),$cardToDelete=e.currentTarget.closest(".card"),openModal($deleteModal)})}),deleteAccount&&deleteAccount.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),openModal($deleteAccountModal)}),logoutDevices&&logoutDevices.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),openModal($logoutDevicesModal)}),document.querySelectorAll(".category-trash").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),$categoryToDelete=e.currentTarget,openModal($deleteCategoryModal)})}),document.querySelectorAll(".empty-trash").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),openModal($emptyTrashModal)})}),document.getElementById("confirm-category-delete").addEventListener("click",async()=>{var e;$categoryToDelete&&(e=$categoryToDelete.dataset.uid,(await fetch("/api/v1/categories/"+e,{method:"DELETE",headers:{"Content-type":applicationJson}})).ok?sessionStorage.setItem(toastSuccess,categoryDeletedSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard"),closeModal($deleteCategoryModal)}),document.getElementById("confirm-logout-devices").addEventListener("click",async()=>{(await fetch("/dashboard/profile/logout-devices",{method:"POST"})).ok?sessionStorage.setItem(toastSuccess,logoutDevicesSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard/profile"}),document.getElementById("confirm-empty-trash").addEventListener("click",async()=>{(await fetch("/api/v1/items/trash",{method:"DELETE",headers:{"Content-type":applicationJson}})).ok?sessionStorage.setItem(toastSuccess,trashEmptiedSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard"}),document.getElementById("confirm-delete").addEventListener("click",async()=>{var e,t;$cardToDelete&&($cardToDelete.style.transition="all 0.3s ease",$cardToDelete.style.opacity="0",setTimeout(()=>{$cardToDelete.closest(".column").remove()},300),e=$cardToDelete.dataset.uid,t=$cardToDelete.dataset.category,(await fetch("/api/v1/items/"+e,{method:"PUT",headers:{"Content-type":applicationJson}})).ok?sessionStorage.setItem(toastSuccess,bookmarkDeletedSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard/"+t)}),$addBookmarkSubmit&&$addBookmarkSubmit.addEventListener("click",async e=>{e.preventDefault();e=document.getElementById("category").value;e?((await fetch("/api/v1/categories",{method:"POST",body:JSON.stringify({name:e}),headers:{"Content-type":applicationJson}})).ok?sessionStorage.setItem(toastSuccess,categoryCreatedSuccess):sessionStorage.setItem(toastError,error),document.getElementById("category").value="",closeAllModals(),window.location.href="/dashboard"):document.getElementById("category").classList.add("is-danger")}),$bookmarkUrl&&$bookmarkUrl.addEventListener("input",()=>{$bookmarkUrl.classList.remove("is-danger")}),window.addEventListener("load",()=>{var e=sessionStorage.getItem(toastSuccess),e=(e&&(showToast(e),sessionStorage.setItem(toastSuccess,"")),sessionStorage.getItem(toastError));e&&(showToast(e,"error"),sessionStorage.setItem(toastError,""))}),fabButton&&fabButton.addEventListener("click",()=>{openModal($addBookmark)}),$confirmAddBookmark&&$confirmAddBookmark.addEventListener("click",async e=>{e.preventDefault();var e=document.getElementById("bookmark-url").value,t=document.getElementById("bookmark-category").value;e&&t&&($confirmAddBookmark.classList.add("is-loading"),$confirmAddBookmark.disabled=!0,(await fetch("/api/v1/items",{method:"POST",headers:{"Content-type":applicationJson},body:JSON.stringify({url:e,category:t.toLowerCase()})})).ok?sessionStorage.setItem(toastSuccess,bookmarkCreatedSuccess):sessionStorage.setItem(toastError,error),closeAllModals(),window.location.href="/dashboard/"+t,$addBookmarkSubmit.classList.remove("is-loading"),$addBookmarkSubmit.disabled=!1)}),document.querySelectorAll(".image-container").forEach(e=>{let t=e.querySelector(".image-with-fallback"),o=e.querySelector(".spinner");let a=!1;e=()=>{a||(a=!0,o.style.display="none",t.style.display="block")};let s=()=>{a||(a=!0,o.style.display="none",t.style.display="block",t.src="/assets/images/placeholder.svg")};t.onload=e,t.onerror=s,t.complete?(0<t.naturalWidth?e:s)():setTimeout(()=>{a||s()},4e3)}),searchInput&&searchInput.addEventListener("input",function(e){let t=e.target.value.toLowerCase();document.querySelectorAll(".card").forEach(e=>{e.querySelector(".card-title").textContent.toLowerCase().includes(t)?e.closest(".column").style.display="":e.closest(".column").style.display="none"})}),document.addEventListener("keydown",function(e){var t;"Enter"===e.key&&(t=document.querySelector(".modal.is-active"))&&(t=t.querySelector("[data-confirm]"))&&(e.preventDefault(),t.click())}),poll();