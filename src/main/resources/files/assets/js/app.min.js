const $id=e=>document.getElementById(e),$=e=>document.querySelector(e),$$=e=>document.querySelectorAll(e),on=(e,t,a)=>{let o="string"==typeof e?document.querySelector(e):e;o&&o.addEventListener(t,a)},onAll=(e,t,a)=>{let o=$$(e);o.length&&o.forEach(e=>e.addEventListener(t,a))},forAll=(e,t)=>{let a=$$(e);a.length&&a.forEach(t)};let $cardToDelete=null,$categoryToRename=null;const toastSuccess="toast-success",toastError="toast-error",i18n=$id("i18n-js").dataset,generalError=i18n.error,bookmarkMovedSuccess=i18n.bookmarkMovedSuccess,categoryDeletedSuccess=i18n.categoryDeletedSuccess,categoryRenamedSuccess=i18n.categoryRenamedSuccess,trashEmptiedSuccess=i18n.trashEmptiedSuccess,bookmarkDeletedSuccess=i18n.bookmarkDeletedSuccess,categoryCreatedSuccess=i18n.categoryCreatedSuccess,bookmarkCreatedSuccess=i18n.bookmarkCreatedSuccess,logoutDevicesSuccess=i18n.logoutDevicesSuccess;function openModal(e){e.classList.add("is-active"),"add-category-modal"===e.id&&setTimeout(()=>{$id("category").focus()},100)}function closeModal(e){e.classList.remove("is-active")}function closeAllModals(){forAll(".modal",closeModal)}function showLoading(e){let t=$id(e);t&&(t.classList.add("is-loading"),t.disabled=!0)}function handleAddClick(){openModal($id("add-category-modal"))}function handleDragStart(e){let t=e.currentTarget,a=document.createElement("div");a.className="drag-icon",a.innerHTML='<i class="fas fa-bookmark fa-2x"></i>',a.style.position="absolute",a.style.top="-1000px",a.style.color="#3273dc",document.body.appendChild(a),e.dataTransfer.setDragImage(a,25,25),t.closest(".card")?.classList.add("dragging"),e.dataTransfer.setData("text/plain",t.dataset.uid),setTimeout(()=>{document.body.removeChild(a)},0)}function handleDragEnd(e){let t=e.currentTarget;t.closest(".card")?.classList.remove("dragging")}function handleDragOver(e){e.preventDefault(),e.currentTarget.classList.add("drag-over")}function handleDragLeave(e){e.currentTarget.classList.remove("drag-over")}function handleDrop(e){e.preventDefault();let t=e.currentTarget;t.classList.remove("drag-over");let a=e.dataTransfer.getData("text/plain"),o=t.dataset.uid;axios.put("/api/v1/items",{uid:a,category:o}).then(function(e){sessionStorage.setItem(toastSuccess,bookmarkMovedSuccess)}).catch(function(e){console.log(e),sessionStorage.setItem(toastError,generalError)}).finally(function(){window.location.href="/dashboard"})}function handleCardTrashClick(e){e.preventDefault(),e.stopPropagation(),deleteItem(e.currentTarget.closest(".card"))}function handleDeleteAccountClick(e){e.preventDefault(),e.stopPropagation(),openModal($id("delete-account-modal"))}function handleLogoutDevicesClick(e){e.preventDefault(),e.stopPropagation(),openModal($id("logout-devices-confirm-modal"))}function handleCategoryTrashClick(e){e.preventDefault(),e.stopPropagation(),$categoryToDelete=e.currentTarget,openModal($id("delete-category-confirm-modal"))}function handleCategoryRenameClick(e){e.preventDefault(),e.stopPropagation(),$categoryToRename=e.currentTarget,$id("existing-category").value=$categoryToRename.dataset.name,openModal($id("rename-category-modal"))}function handleConfirmCategoryDelete(){if($categoryToDelete){let e=$categoryToDelete.dataset.uid;axios.delete("/api/v1/categories/"+e).then(function(e){closeAllModals(),sessionStorage.setItem(toastSuccess,categoryDeletedSuccess)}).catch(function(e){console.log(e),sessionStorage.setItem(toastError,generalError)}).finally(function(){closeAllModals(),window.location.href="/dashboard"})}}function handleLogoutDevices(){axios.post("/dashboard/profile/logout-devices").then(function(e){closeAllModals(),sessionStorage.setItem(toastSuccess,logoutDevicesSuccess)}).catch(function(e){console.log(e),sessionStorage.setItem(toastError,generalError)}).finally(function(){window.location.href="/dashboard/profile"})}function handleAddCategory(e){e.preventDefault();let t=$id("category"),a=t?.value;a?axios.post("/api/v1/categories",{name:a}).then(function(e){sessionStorage.setItem(toastSuccess,categoryCreatedSuccess),t.value="",closeAllModals()}).catch(function(e){console.log(e),sessionStorage.setItem(toastError,generalError)}).finally(function(){window.location.href="/dashboard"}):t?.classList.add("is-danger")}function handleRenameCategory(e){e.preventDefault();let t=$id("existing-category"),a=$categoryToRename.dataset.uid,o=t?.value;o?axios.put("/api/v1/categories",{uid:a,name:o}).then(function(e){sessionStorage.setItem(toastSuccess,categoryRenamedSuccess),t.value="",closeAllModals()}).catch(function(e){console.log(e),sessionStorage.setItem(toastError,generalError)}).finally(function(){window.location.href="/dashboard/"+a}):t?.classList.add("is-danger")}function confirmEmptyTrash(){axios.delete("/api/v1/items/trash").then(function(e){closeAllModals(),sessionStorage.setItem(toastSuccess,trashEmptiedSuccess)}).catch(function(e){console.log(e),sessionStorage.setItem(toastError,generalError)}).finally(function(){window.location.href="/dashboard"})}function deleteItem(e){e.style.transition="all 0.3s ease",e.style.opacity="0",setTimeout(()=>{e.closest(".column").remove()},300);let t=e.dataset.uid,a=e.dataset.category;axios.put("/api/v1/items/"+t).then(()=>{closeAllModals(),sessionStorage.setItem(toastSuccess,bookmarkDeletedSuccess)}).catch(e=>{console.log(e),sessionStorage.setItem(toastError,e)}).finally(()=>{window.location.href="/dashboard/"+a})}function emptyTrash(e){e.preventDefault(),e.stopPropagation(),openModal($id("empty-trash-confirm-modal"))}function clearUrlError(){$id("bookmark-url")?.classList.remove("is-danger")}function showToast(e,t="success",a=3e3){let o=document.querySelector(".toast-container");if(!o)return;let r=document.createElement("div");r.className=`toast ${"error"===t?"is-danger":""}`,r.innerHTML=`
        <span class="icon">
            <i class="fas ${"error"===t?"fa-exclamation-circle":"fa-check-circle"}"></i>
        </span>
        <span>${e}</span>
    `,o.appendChild(r),r.offsetHeight,requestAnimationFrame(()=>{r.classList.add("is-active")}),setTimeout(()=>{r.classList.remove("is-active"),setTimeout(()=>{o.removeChild(r)},300)},a)}function addBookmarkModal(){openModal($id("add-bookmark-modal"))}function handleToastsOnLoad(){let e=sessionStorage.getItem(toastSuccess);e&&(showToast(e),sessionStorage.removeItem(toastSuccess));let t=sessionStorage.getItem(toastError);t&&(showToast(t,"error"),sessionStorage.setItem(toastError,""))}function addBookmark(e){e.preventDefault(),e.stopPropagation();let t=$id("bookmark-url").value,a=$id("bookmark-category").value,o=$id("confirm-add-bookmark");t&&a&&(o.classList.add("is-loading"),o.disabled=!0,axios.post("/api/v1/items",{url:t,category:a}).then(function(e){sessionStorage.setItem(toastSuccess,bookmarkCreatedSuccess),closeAllModals(),window.location.href="/dashboard/"+a}).catch(function(e){console.log(e),sessionStorage.setItem(toastError,generalError)}).finally(function(){o.classList.remove("is-loading"),o.disabled=!1}))}function search(e){if(!e?.target?.value)return;let t=e.target.value.toLowerCase(),a=$$(".card");a.forEach(e=>{let a=e.querySelector(".card-title")?.textContent.toLowerCase()||"",o=e.closest(".column");o&&(o.style.display=a.includes(t)?"":"none")})}function handleKeyNavigation(e){if("Enter"===e.key){let t=$(".modal.is-active");if(!t)return;let a=t.querySelector("[data-confirm]");a&&(e.preventDefault(),a.click())}"Escape"===e.code&&closeAllModals()}async function poll(){try{let e=$$(".card").length,t=window.location.pathname.match(/\/dashboard\/(.+)/),a=t?t[1]:null;axios.post("/api/v1/categories/poll",{count:e.toString(),category:a},{validateStatus:function(e){return 200===e||304===e}}).then(function(e){200===e.status&&location.reload()}).catch(function(e){console.log(e)}),setTimeout(poll,3e3)}catch(o){console.log(o)}}on(document,"keydown",handleKeyNavigation),on(window,"load",handleToastsOnLoad),on("#add-category-button","click",handleAddClick),on("#add-category-submit","click",handleAddCategory),on("#rename-category-submit","click",handleRenameCategory),on("#confirm-empty-trash","click",confirmEmptyTrash),on("#bookmark-url","input",clearUrlError),on("#add-bookmark","click",addBookmarkModal),on("#search-input","input",search),on("#confirm-add-bookmark","click",addBookmark),on("#confirm-logout-devices","click",handleLogoutDevices),on("#logout-devices","click",handleLogoutDevicesClick),on("#delete-account","click",handleDeleteAccountClick),on("#confirm-category-delete","click",handleConfirmCategoryDelete),onAll(".category-trash","click",handleCategoryTrashClick),onAll(".category-rename","click",handleCategoryRenameClick),onAll(".card-trash","click",handleCardTrashClick),onAll(".modal-background, .modal-card-head .delete, .modal-card-foot .button:not(.is-danger)","click",closeAllModals),onAll(".empty-trash","click",emptyTrash),forAll('.dragging[draggable="true"]',e=>{e.addEventListener("dragstart",handleDragStart),e.addEventListener("dragend",handleDragEnd)}),forAll(".menu-list a[data-category]",e=>{e.addEventListener("dragover",handleDragOver),e.addEventListener("dragleave",handleDragLeave),e.addEventListener("drop",handleDrop)}),poll();